<!DOCTYPE html>
<html>
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>
<body>
    <h1>Fermate ATM</h1>
    <div id="fermate">

    </div>
<script>

var cors = 'https://cors-anywhere.herokuapp.com/';
var url = 'https://giromilano.atm.it/proxy.ashx';

// tram 14 - direzione milano
// gonin giordani = 10204
// s. cristoforo = 10335
// giambellino sanniti = 10337
// bus 49 - direzione s cristoforo
// 10328
// bus 49 - direzione inganni
// 10332
// bus 50 - direzione milano
// 10326

chiamafermata(11175, 'stops');
chiamafermata(11176, 'stops');

chiamafermata(10890, 'stops');
chiamafermata(10893, 'stops');

//chiamafermata(10328, 'stops');
// chiamafermata(10204, 'stops');
// chiamafermata(10332, 'stops');
// chiamafermata(10326, 'stops');

function chiamafermata(fermataid, tipo) {
    var fd = new FormData();   
    fd.append("url", "tpPortal/geodata/pois/" + tipo + "/" + fermataid);
    $.ajax({
        type: "POST",
        url: cors + url,
        crossDomain: true,
        contentType: false,
        processData: false,
        data: fd,
        success: function (data) {
            // do something with server response data
            console.log(data);
            creafermata(fermataid, data);
        },
        error: function (err) {
            console.log(err);
            // handle your error logic here
        }
    });
}

function creafermata(id, info) {
    if (info['Lines'][0]['WaitMessage'] != 'soppressa') {
        html = "<div class='fermata'>";
        html+= "<span class='title'>" + info['Description'] + "</span> - ";
        html+= "<span class='linea'>" + info['Lines'][0]['Line']['LineCode'] + "</span> - ";
        html+= "<span class='linea'>Direzione: " + info['Lines'][0]['Line']['LineDescription'].split(" - ").pop() + "</span> - ";
        html+= "<span class='orario'>" + info['Lines'][0]['WaitMessage'] + "</span>";
        html+= "</div>";
        $('#fermate').append(html);
    }
    console.log(info['Lines'][0]['BookletUrl2']);
}

</script>
    
</body>
</html>