/**
 * Altervista Pushdown Loader System
 * Manages both mobile and desktop pushdown format
 * Manages video content player with adv
 * Enables lazy and fast loading of external resources
 * Works under AMP, Sandboxed Environment, and in multi-instance configuration
 *
 * @version 2.4.5
 * @author Alessandro Maurizio <alessandro.maurizio@altervista.it>
 * @preserve
 */
class AVPushdownLoader{constructor(e,t=0){this.version="2.4.5",this.instanceName="AVPushdown",this.resourceStatus="LOADING",this.htmlStatus="LOADING",this.dataStatus="LOADING",this.startTime=(new Date).getTime(),this.diffStartTime=0|performance.now(),this.dataSaver="connection"in navigator&&!0===navigator.connection.saveData,this.htmlElems={},this.runningWindow=window,this.isSandboxed=!1,t>1&&(this.instanceName+=t);try{window.parent.location.href,this.runningWindow=window.parent,this.log("AV Pushdown è in esecuzione in ambiente nativo pagina","DEBUG")}catch(e){this.log("AV Pushdown è in esecuzione in ambiente Sandboxed (AMP o iFrame). Modalità di compatibilità attivata","WARNING"),this.isSandboxed=!0}if(this.opt={website:void 0,type:void 0,adServer:void 0,mode:"pushdown",videoId:void 0,flyMode:"flight",position:"preroll",hasAdv:!0,flightEnabled:!0,swipeEnabled:!0,pausePrerollOnClose:!1,prerollAutoplay:!0,contentAutoplay:!1,playVideoPlaylist:!1,advFallbacks:!1,hideWithButton:!1,preferMaxQuality:!1,keepAspectRatio:!0,targetElementId:void 0,baseUrl:"https://ptp.stbm.it/pushdown/loader/av/",ajaxUrl:"https://ptp.stbm.it/pushdown/pager-pushdown-v-5-data.php"},this.opt=Object.assign(this.opt,e),this.injectGoogleAnalytics(),this.log("Inizializzazione AV Pushdown v"+this.version+" - Sito: "+this.opt.website+" | Tipo: "+(this.opt.type||this.opt.mode)+" | AdServer: "+this.opt.adServer,"INFO","Loader",!0),this.track("player_beginload"),!this.opt.targetElementId){let e=!1;this.opt.mobile&&this.opt.mobile.targetElementId&&"mobile"===this.opt.type?(this.opt.targetElementId=this.opt.mobile.targetElementId,e=!0):this.opt.desktop&&this.opt.desktop.targetElementId&&"desktop"===this.opt.type&&(this.opt.targetElementId=this.opt.desktop.targetElementId,e=!0),e&&this.log("Configurazione legacy rilevata: l'opzione 'TargetElementId' ora va dichiarata come le altre opzioni, senza specificare 'sizes' o il tipo desktop/mobile","WARNING")}this.opt.targetElementId||("pushdown"===this.opt.mode&&"desktop"===this.opt.type?this.opt.targetElementId="av-pushdown-wrapper":"content"===this.opt.mode?this.opt.targetElementId="av-content-wrapper":this.opt.targetElementId="body"),"content"===this.opt.mode&&(this.opt.type=void 0),this.validate()&&(this.opt=Object.assign(this.opt,{requiredResources:["manager/pushdown-styles.css?v="+this.version,"manager/pushdown-manager.js?v="+this.version],delayedResources:["resources/adv-player-styles.css?v="+this.version,"resources/hls.light.min.js?v="+this.version,"resources/custom-controls.css?v="+this.version,"resources/player-icons.svg?v="+this.version],SDKs:{freewheel:["https://mssl.fwmrm.net/libs/adm/6.27.0/AdManager.js"],ima:["https://imasdk.googleapis.com/js/sdkloader/ima3.js","resources/vans-adapter-google-ima.js"]},players:{freewheel:"players/player-custom-freewheel.js?v="+this.version,ima:"players/player-custom-dfp.js?v="+this.version,content:"players/player-custom-content.js?v="+this.version},sizes:{mobile:{width:300,height:164},desktop:{width:441,height:247},content:{width:750,height:422}}}),this.playersConfig={freewheel:{videoElemId:"fwVideoPlayer",displayBaseId:"fwDisplayBase"},dfp:{videoElemId:"dfpVideoPlayer",displayBaseId:"dfpDisplayBase",adContainerId:"dfpAdContainer",adTagBase:"https://pubads.g.doubleclick.net/gampad/ads?iu=",adTagParams:"&description_url="+encodeURIComponent(this.runningWindow.location.href)+"&env=vp&impl=s&tfcd=0&npa=0&gdfp_req=1&output=vast&sz=400x300&unviewed_position_start=1&ad_rule=0&vpos="+this.opt.position},content:{displayBaseId:"contentDisplayBase",videos:[]}},this.init())}validate(){return this.opt.website&&this.opt.adServer?"pushdown"!==this.opt.mode&&"content"!==this.opt.mode?(this.log("Modalità invalida! Seleziona una tra 'pushdown' e 'content'!","FATAL"),!1):"pushdown"===this.opt.mode&&"mobile"!==this.opt.type&&"desktop"!==this.opt.type?(this.log("Tipo selezionato invalido! Seleziona una tra 'mobile' e 'desktop' in modalità Pushdown!","FATAL"),!1):!("body"!==this.opt.targetElementId&&!document.getElementById(this.opt.targetElementId))||(this.log("L'elemento target "+this.opt.targetElementId+" non è stato trovato in pagina. Inserire correttamente il div richiesto per usare la Pushdown.","FATAL"),!1):(this.log("Sito o adserver non validi. Assicurati di aver inizializzato il loader correttamente!","FATAL"),!1)}init(){let e=this;if(this.dataSaver){if(this.track("datasaver_detected"),"pushdown"===e.opt.mode&&"mobile"===e.opt.type)return void this.log("Modalità Data Saver attiva! Il sistema si disattiverà adesso!","FATAL");this.log("Modalità Data Saver attiva! Il sistema potrebbe non funzionare correttamente!","WARNING")}this.log("Caricamento risorse esterne di base, richiesta dati e injection HTML..."),this.loadRequiredResources().then(function(){e.log("Risorse esterne essenziali caricate con successo! Avvio Manager.."),e.manager=new AVPushdownManager(e),e.resourceStatus="READY",e.maybeStart()}).catch(function(t){e.log("Errore caricamento risorse: "+t,"FATAL")}),this.injectHtml().then(function(){e.log("Container HTML inserito correttamente!"),e.htmlStatus="READY",e.maybeStart()}).catch(function(){e.log("Errore durante l'injection del container HTML","FATAL")}),this.requireConfiguration().then(function(){e.log("Richiesta AJAX completata: dati di configurazione ottenuti!"),e.dataStatus="READY",e.maybeStart()}).catch(function(t){e.log("Errore durante la richiesta configurazione da PTP: "+t,"FATAL")})}maybeStart(){let e=this;"READY"===this.htmlStatus&&"READY"===this.resourceStatus&&"READY"===this.dataStatus&&(this.log("Injection player, injection playlist e avvio sistema..."),this.injectFrame().then(function(t){"sandbox_skip"===t?e.log("Sandbox: injection dell'iFrame esclusa - caricamento risorse"):e.log("iFrame inserito in pagina - caricamento risorse interne"),e.injectInternalResources().then(function(t){"adv_skip"===t?(e.log("Sistema pubblicitario escluso - procedo al contenuto"),e.afterLaunch().then(function(){e.launchContentPlayer()})):"no_preroll_autoplay"===t?(e.log("Sistema pubblicitario in pausa, attivazione dopo il play - procedo al contenuto"),e.afterLaunch().then(function(){e.launchContentPlayer()})):(e.log("Risorse interne inserite - caricamento risorse secondarie"),e.afterLaunch())}).catch(function(t){"content"===e.opt.mode&&"adblocker_detected"===t?(e.log("Errore durante l'inserimento delle risorse interne causa possibile AdBlock - Lancio contenuto..","WARNING"),e.afterLaunch().then(function(){e.launchContentPlayer()})):e.log("Errore durante l'inserimento delle risorse interne - Interruzione lancio pushdown","FATAL")})}).catch(function(){e.log("Errore durante l'inserimento e l'avvio della creatività","FATAL")}),"pushdown"!==this.opt.mode||"desktop"!==this.opt.type||this.desktopPlaylistInjected||this.injectVideoPlaylist().then(function(){e.log("Correttamente inserita Video Playlist Desktop!")}).catch(function(t){e.log("Errore durante l'inserimento della Video Playlist Desktop: "+t,"FATAL")}))}loadRequiredResources(){let e=this,t=[];return this.opt.requiredResources.forEach(function(o){/^(www|https?:\/\/)/g.test(o)||(o=e.opt.baseUrl+o),t.push(e.constructor.resourceLoader(o).then(function(t){"resource_already_loaded"===t?e.log("Duplicato: risorsa "+o+" già presente","DEBUG"):e.log("Risorsa "+o+" caricata correttamente","DEBUG")}))}),Promise.all(t)}injectHtml(){let e=this;return new Promise(function(t,o){e.htmlElems.stCont=document.createElement("div"),e.htmlElems.stCont.classList.add("av-push-static"),e.htmlElems.flCont=document.createElement("div"),e.htmlElems.flCont.classList.add("av-push-flying"),e.htmlElems.closePush=document.createElement("a"),e.htmlElems.closePush.classList.add("close-av-push"),e.htmlElems.closePush.style.display="none",e.htmlElems.closePush.innerHTML='<svg viewBox="0 0 512 512" xml:space="preserve"><polygon points="438.39 374.6 319.76 255.98 438.38 137.35 374.6 73.607 256 192.22 137.38 73.622 73.607 137.35 192.25 255.98 73.622 374.62 137.35 438.39 256 319.73 374.65 438.38"></polygon></svg>',e.htmlElems.flCont.appendChild(e.htmlElems.closePush),e.htmlElems.stCont.appendChild(e.htmlElems.flCont);let i=e.htmlElems.stCont;"pushdown"===e.opt.mode&&"desktop"===e.opt.type&&(e.htmlElems.deskCont=document.createElement("div"),e.htmlElems.deskCont.classList.add("av-pushdesktop-container"),e.htmlElems.playlistCont=document.createElement("div"),e.htmlElems.playlistCont.classList.add("av-pushdown-playlist"),e.htmlElems.deskCont.appendChild(e.htmlElems.stCont),e.htmlElems.deskCont.appendChild(e.htmlElems.playlistCont),i=e.htmlElems.deskCont);let a=e.opt.targetElementId;e.htmlElems.wrapper="body"===a?document.createElement("div"):document.getElementById(a),"pushdown"===e.opt.mode&&"mobile"===e.opt.type?(e.htmlElems.wrapper.classList.add("av-pushdown-wrapper"),e.htmlElems.stCont.classList.add("av-push-static-mobile")):"pushdown"===e.opt.mode&&"desktop"===e.opt.type?(e.htmlElems.wrapper.classList.add("av-pushdown-wrapper"),e.htmlElems.stCont.classList.add("av-push-static-desktop")):"content"===e.opt.mode&&(e.htmlElems.wrapper.classList.add("av-content-wrapper"),e.htmlElems.stCont.classList.add("av-push-static-content")),e.opt.keepAspectRatio||e.htmlElems.wrapper.classList.add("no-aspect"),e.htmlElems.wrapper.switchVideo=function(t){e.contentPlayer&&e.contentPlayer.switchVideo(t)},e.htmlElems.wrapper.appendChild(i),"body"===a&&document.body.insertBefore(e.htmlElems.wrapper,document.body.firstChild),document.body.contains(e.htmlElems.wrapper)?t():o()})}injectVideoPlaylist(){let e=this;return new Promise(function(t,o){try{for(let t=0;t<2;t++){let o=e.playersConfig.content.videos[t],i=document.createElement("a");i.classList.add("video-row"),i.setAttribute("id","video-"+o.vkey),e.opt.playVideoPlaylist?(e.htmlElems.playlistCont.classList.add("play-mode"),i.onclick=function(){e.contentPlayer&&(e.contentPlayer.switchVideo(o.vkey),e.htmlElems.playlistCont.querySelectorAll(".video-row").forEach(function(e){e.classList.remove("active")}),i.classList.add("active"))},0===t&&i.classList.add("active")):(i.href=o.link,i.target="_blank");let a=document.createElement("figure");a.classList.add("img-cont");let n=document.createElement("img");n.src=o.thumb,a.append(n);let s=document.createElement("div");s.classList.add("text-cont");let r=document.createElement("p");r.classList.add("category"),r.innerHTML=o.categoria;let l=document.createElement("p");l.classList.add("title"),l.innerHTML=o.titolo,s.append(r),s.append(l),i.append(a),i.append(s),e.htmlElems.playlistCont.appendChild(i)}if(e.playersConfig.content.seeAllLink){let t=document.createElement("a");t.classList.add("see-other-cont"),t.innerHTML='<svg viewBox="0 0 48 48"><path d="M17.17 32.92l9.17-9.17-9.17-9.17 2.83-2.83 12 12-12 12z"/><path d="M0-.25h48v48h-48z" fill="none"/></svg>',t.href=e.playersConfig.content.seeAllLink,t.target="_blank",e.htmlElems.playlistCont.appendChild(t)}e.desktopPlaylistInjected=!0,document.body.contains(e.htmlElems.playlistCont)?t():o()}catch(t){e.log("Errore durante l'injection della playlist desktop!","ERROR"),console.error(t)}})}requireConfiguration(){let e=this;return new Promise(function(t,o){let i="desktop";if("mobile"===e.opt.type&&(i="mobile_"+e.constructor.getMobileOperatingSystem()),"content"===e.opt.mode){let e=navigator.userAgent||navigator.vendor||window.opera,t={ipad:"tablet_ios","ip(hone|od)":"mobile_ios","android.*(mobile|mini)":"mobile_android","android 3i":"tablet_android","Opera Mobi":"mobile_other",android:"tablet_android","PlayBook; U; RIM Tablet":"tablet_other","hp-tablet.*TouchPad":"tablet_other","Kindle/3":"tablet_android","Silk/":"tablet_android","NokiaBrowser/":"mobile_other"};for(let[o,a]of Object.entries(t))if(new RegExp(o,"i").test(e)){i=a;break}}let a=e.opt.ajaxUrl+"?website="+e.opt.website+"&advertiser="+e.opt.adServer+"&platform="+i+"&cb="+(new Date).getDate()+((new Date).getMonth()+1);"content"===e.opt.mode&&(a+="&videoId="+e.opt.videoId),e.log("Richiesta AJAX Fetch in corso. URL: "+a,"DEBUG"),fetch(a,{headers:{"Content-Type":"application/json; charset=utf-8"}}).then(e=>e.json()).then(i=>{if(i.error||i.errore)return o(i.error||i.errore);let a={},n={};"freewheel"===e.opt.adServer?(a=i.freewheelConf).waitViewability=i.waitViewability:"ima"===e.opt.adServer&&((n=i.dfpConf).adTagUrl=e.playersConfig.dfp.adTagBase+n.pushVastParams+e.playersConfig.dfp.adTagParams,n.waitViewability=i.waitViewability),i.canFallback&&(e.fallbackServer=i.fallbackData.fallbackServer,"freewheel"===e.fallbackServer?(a=i.fallbackData.freewheelConf).waitViewability=i.waitViewability:"ima"===e.fallbackServer&&((n=i.fallbackData.dfpConf).adTagUrl=e.playersConfig.dfp.adTagBase+n.pushVastParams+e.playersConfig.dfp.adTagParams,n.waitViewability=i.waitViewability));let s=e.playersConfig.content;s.videos.push(i.video_uno),s.videos.push(i.video_due),s.seeAllLink=i.vediTutti,e.googleAnalyticsData.cd3=i.video_uno.vkey,e.googleAnalyticsData.cd5=i.video_uno.titolo,i.nielsenEnabled&&(s.nielsenData=i.nielsenData),e.playersConfig.freewheel=Object.assign(e.playersConfig.freewheel,a),e.playersConfig.dfp=Object.assign(e.playersConfig.dfp,n),e.playersConfig.content=Object.assign(e.playersConfig.content,s),t()}).catch(t=>{e.log("Errore durante il fetch AJAX della configurazione Pushdown! Errore => "+t,"FATAL"),o(t)})})}injectFrame(){let e=this;return new Promise(function(t,o){if(e.isSandboxed)return a(document.body,e.htmlElems.flCont),t("sandbox_skip");let i=document.createElement("iframe");function a(t,o=t){t.style.margin="0",t.style.padding="0",t.style.width="100%",t.style.height="100%";let i=document.createElement("div");i.style.width="100%",i.style.height="100%",o.appendChild(i),e.htmlElems.pushResultDiv=i}i.scrolling="no",i.setAttribute("allowFullScreen","true"),e.htmlElems.mainFrame=i,"pushdown"===e.opt.mode?i.classList.add("av-pushdown-frame"):"content"===e.opt.mode&&i.classList.add("av-content-frame"),i.setAttribute("width",e.opt.sizes[e.opt.type||e.opt.mode].width.toString()),i.setAttribute("height",e.opt.sizes[e.opt.type||e.opt.mode].height.toString()),i.onload=function(){a(i.contentDocument.body),document.body.contains(i)?t():o()},e.htmlElems.flCont.appendChild(i)})}injectInternalResources(){let e=this;return new Promise(function(t,o){if(!e.opt.hasAdv)return t("adv_skip");let i=e.runningWindow;e.isSandboxed||(i=e.htmlElems.mainFrame.contentWindow);let a=e.opt.SDKs[e.opt.adServer];e.log("Caricamento SDK Interno: "+e.opt.adServer,"INFO");let n=[];a.forEach(function(t){/^(www|https?:\/\/)/g.test(t)||(t=e.opt.baseUrl+t),n.push(e.constructor.resourceLoader(t,i.document).then(function(){e.log("Risorsa "+t+" caricata correttamente","DEBUG")}))}),Promise.all(n).then(function(){e.log("Risorse per player "+e.opt.adServer+" inserite. Caricamento player...","INFO");let a=e.opt.players[e.opt.adServer];/^(www|https?:\/\/)/g.test(a)||(a=e.opt.baseUrl+a),e.constructor.resourceLoader(a,i.document).then(function(){e.log("Player custom "+e.opt.adServer+" caricato correttamente - lancio in corso","INFO"),e.opt.prerollAutoplay?(e.launchAdvPlayer(),t()):t("no_preroll_autoplay")}).catch(function(t){e.log("Errore caricamento player custom: "+t,"FATAL"),o()})}).catch(function(t){e.log("Possibile Adblocker! Errore caricamento SDK: "+t,"ERROR"),e.track("adblocker_detected"),o("adblocker_detected")})})}afterLaunch(){let e=this;return new Promise(function(t,o){let i=e.runningWindow.document;e.isSandboxed||(i=e.htmlElems.mainFrame);let a=[];e.opt.delayedResources.forEach(function(t){/^(www|https?:\/\/)/g.test(t)||(t=e.opt.baseUrl+t),a.push(e.constructor.resourceLoader(t,i).then(function(){e.log("Risorsa "+t+" caricata correttamente","DEBUG")}))}),Promise.all(a).then(function(){e.log("Risorse secondarie caricate correttamente! Caricamento Player Custom..","INFO");let a=e.opt.players.content;/^(www|https?:\/\/)/g.test(a)||(a=e.opt.baseUrl+a),e.constructor.resourceLoader(a,i).then(function(){e.log("Player custom caricato correttamente! Attendo fine preroll..","INFO"),t()}).catch(function(t){e.log("Errore caricamento player contenuto: "+t,"FATAL"),o()})}).catch(function(t){e.log("Errore caricamento risorse secondarie: "+t,"FATAL"),o()})})}launchContentPlayer(e){try{let t;if(this.htmlElems.mainFrame&&(t=this.htmlElems.mainFrame.contentWindow.CustomContentPlayer),t||(t=window.CustomContentPlayer),t){if(!e){let t=document.createElement("div");t.setAttribute("id",this.playersConfig.content.displayBaseId),this.htmlElems.contentDisplayBase=t,(e=document.createElement("video")).setAttribute("playsinline","true"),e.setAttribute("id","contentVideoPlayer"),this.htmlElems.contentVideo=e,t.appendChild(e),this.htmlElems.pushResultDiv.appendChild(t)}this.contentPlayer=new t(this,e)}else this.log("Impossibile lanciare Content Player - Non trovato in pagina o iframe!","FATAL")}catch(e){this.log("Errore di inizializzazione Content Player! StackTrace:","ERROR"),console.error(e)}}launchAdvPlayer(){try{let e;"freewheel"===this.opt.adServer?(this.htmlElems.mainFrame&&(e=this.htmlElems.mainFrame.contentWindow.CustomFreeWheelPlayer),e||(e=window.CustomFreeWheelPlayer)):"ima"===this.opt.adServer?(this.htmlElems.mainFrame&&(e=this.htmlElems.mainFrame.contentWindow.CustomDfpPlayer),e||(e=window.CustomDfpPlayer)):this.log("ADServer + "+this.opt.adServer+" non riconosciuto! Valori consentiti: 'freewheel' e 'ima'","FATAL"),e?this.advPlayer=new e(this):this.log("Impossibile lanciare ADV Player "+this.opt.adServer+" - Non trovato in pagina o iframe!","FATAL")}catch(e){this.log("Errore di inizializzazione ADV Player "+this.opt.adServer+" da loader! StackTrace:","ERROR"),console.error(e)}}injectGoogleAnalytics(){void 0===this.clientId&&(this.clientId=Math.random());let e=this.runningWindow.screen.width+"x"+this.runningWindow.screen.height;this.googleAnalyticsData={v:1,aip:1,tid:"UA-1240215-12",cid:this.clientId,t:"event",el:"first_call",dl:this.runningWindow.location.href,ds:"web",ul:navigator.language.toLowerCase(),sr:e,cm1:this.diffStartTime,cd1:this.opt.mode,cd2:this.opt.website},this.runningWindow.location.href.includes("#amp")&&(this.googleAnalyticsData.ds="AMP"),this.opt.videoId&&(this.googleAnalyticsData.cd3=this.opt.videoId),this.opt.type&&"mobile"===this.opt.type&&"pushdown"===this.opt.mode&&(this.googleAnalyticsData.cd4=this.constructor.getMobileOperatingSystem())}launchAdvFallback(){try{this.fallbackEngaged||(this.htmlElems.mainFrame&&this.htmlElems.mainFrame.remove(),this.advPlayer&&delete this.advPlayer,this.fallbackEngaged=!0,this.track("triggered_fallback"),this.opt.adServer=this.fallbackServer,this.maybeStart())}catch(e){this.log("Errore di lancio ADV fallback!","ERROR"),console.error(e)}}static resourceLoader(e,t=document){return e.includes(".js")?i("script",e):e.includes(".css")?i("link",e):!!e.includes(".svg")&&(o=e,new Promise(function(e,i){if("#document"!==t.nodeName&&"IFRAME"!==t.nodeName)return console.error("Errore caricamento risorse resourceLoader: il target per il caricamento non è document o un iFrame."),void i();"IFRAME"===t.nodeName&&(t=t.contentDocument),fetch(o,{headers:{"Content-Type":"image/svg+xml"}}).then(e=>e.text()).then(o=>{let i=document.createRange().createContextualFragment(o);t.body.appendChild(i),e()}).catch(e=>{i(e)})}));var o;function i(e,o){return new Promise(function(i,a){if("#document"===t.nodeName||"IFRAME"===t.nodeName)try{"IFRAME"===t.nodeName&&(t=t.contentDocument);let n,s=0;for(n=0;n<o.length;n++)s=Math.imul(31,s)+o.charCodeAt(n)|0;let r="avPushRes_"+Math.abs(s).toString(),l=t.getElementById(r);if(l)return l.addEventListener("load",function(){l.setAttribute("data-loaded","true"),i("resource_already_loaded")}),void(l.getAttribute("data-loaded")&&i("resource_already_loaded"));let d=document.createElement(e);d.setAttribute("id",r);let c="body",h="src";switch(d.onload=function(){d.setAttribute("data-loaded","true"),i(o)},d.onerror=function(){a("Impossibile caricare "+o)},e){case"script":d.async=!0;break;case"link":d.type="text/css",d.rel="stylesheet",h="href",c="head"}d[h]=o,t[c].appendChild(d)}catch(e){console.error(e),a("Errore Try-Catch durante caricamento risorsa "+o)}else a("Errore caricamento risorse resourceLoader: il target per il caricamento non è document o un iFrame.")})}}log(e,t="INFO",o="Loader",i=!1){let a="WARNING";if(this.runningWindow.location.href.includes("pushdownLog=INFO")&&(a="INFO"),this.runningWindow.location.href.includes("pushdownLog=DEBUG")&&(a="DEBUG"),a===t||"DEBUG"===a||"WARNING"===t||"ERROR"===t||"FATAL"===t||i){let i=console.info,a="#13c454";switch(t){case"DEBUG":i=console.debug,a="#41979b";break;case"WARNING":i=console.warn,a="#EED202";break;case"ERROR":case"FATAL":i=console.error,a="#ef4c37"}let n=Date.now()-this.startTime,s="--";this.runningWindow.performance&&(s=0|performance.now()),i("%c["+this.instanceName+"] %c["+o+"] %c["+t+"] %c"+e+" %c("+n+"ms) (fromStart: "+s+"ms)","color: #b78114","color: #2f74e2","color: "+a,"color: #24ada4","color: #5d697c")}}track(e){let t,o=Date.now()-this.startTime;if(o>2e5||this.diffStartTime>1e5&&!e.includes("content"))return;t=this.opt.hasAdv?this.opt.adServer+"_"+(this.opt.type||this.opt.mode):"noAdv_"+(this.opt.type||this.opt.mode);let i=Object.assign({},this.googleAnalyticsData,{ec:t,ea:e,cm2:o,z:Date.now()});this.fallbackEngaged&&(i.el="fallback_1");let a=new URL("https://www.google-analytics.com/collect");if(a.search=new URLSearchParams(i),navigator.sendBeacon?navigator.sendBeacon(a):new Image(0,0).src=a,"pushdown"===this.opt.mode&&this.runningWindow.avadv&&this.runningWindow.avadv.list[0].dom){let t=`pushdown${this.opt.type.charAt(0).toUpperCase()+this.opt.type.slice(1)}Tracking${this.opt.adServer.charAt(0).toUpperCase()+this.opt.adServer.slice(1)}`;if(this.fallbackEngaged)switch(e){case"pushdown_init":case"preroll_served":case"preroll_not_served":e+="_fallback"}new Image(0,0).src="//"+this.runningWindow.avadv.list[0].dom+"/index.html?track="+t+"&status="+e+"&cb="+Date.now()}this.log("Evento "+e+" registrato e tracciato","INFO","Manager")}static getMobileOperatingSystem(){let e=navigator.userAgent||navigator.vendor||window.opera;return/windows phone/i.test(e)?"other":/android/i.test(e)?"android":/iPad|iPhone|iPod/.test(e)&&!window.MSStream?"ios":"other"}getStatus(){let e="still_not_loaded";return this.contentPlayer&&(e={videoPlayingId:this.contentPlayer.currentVideo.vkey,videoPlayingTitle:this.contentPlayer.currentVideo.titolo,duration:this.contentPlayer.currentVideo.durata,currentTime:this.contentPlayer.videoElement.currentTime}),{instanceName:this.instanceName,version:this.version,startTime:this.startTime,isSandboxed:this.isSandboxed,adv:{adServer:this.opt.adServer,prerollServed:this.manager.statusFlags.creativity,prerollViewed:this.manager.statusFlags.viewed},content:e,display:{flightSystem:this.manager.statusFlags.enabled,isFlying:this.manager.statusFlags.isFlying,isAnimating:this.manager.statusFlags.isAnimating,isClosed:this.manager.statusFlags.closed,actualWidth:this.htmlElems.flCont.offsetWidth,actualHeight:this.htmlElems.flCont.offsetHeight},config:{website:this.opt.website,type:this.opt.type,adServer:this.opt.adServer,mode:this.opt.mode,videoId:this.opt.videoId,flyMode:this.opt.flyMode,position:this.opt.position,hasAdv:this.opt.hasAdv,flightEnabled:this.opt.flightEnabled,swipeEnabled:this.opt.swipeEnabled,pausePrerollOnClose:this.opt.pausePrerollOnClose,prerollAutoplay:this.opt.prerollAutoplay,contentAutoplay:this.opt.contentAutoplay,playVideoPlaylist:this.opt.playVideoPlaylist,advFallbacks:this.opt.advFallbacks,targetElementId:this.opt.targetElementId}}}}let asyncConfigs=[];window.AVPushLoader&&(asyncConfigs=window.AVPushLoader.run||[]);let AVPushRunningInstances=[],AVPushRunningCount=0;window.AVPushLoader=function(e){e&&asyncConfigs.push(e),asyncConfigs.forEach(function(e){AVPushRunningInstances.push(new AVPushdownLoader(e,++AVPushRunningCount))}),window.AVPushLoader.run=[],asyncConfigs=[]},window.AVPushLoader();
