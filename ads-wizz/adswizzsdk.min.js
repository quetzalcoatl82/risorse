!function(){"use strict";function t(t){this.metadataManager=t,this.eventSourceObj=null}function e(t){this.metadataManager=t,this.pollingType=null,this.pollingInterval=null,this.pollingObj=null,this.pollingTimer=null}function a(t){this.sdkInstance=t,this._adBreakCount=0,this._lastAdID="",this._timeoutsAdStart=[],this._timeoutsAdFinish=[]}function n(){this._extraExposureTime=0,this.fallbackRefreshInterval=3e4,this._refreshFillerTimer=null,this._extraExposureTimer=null,this._onStartTimer=null,this._outOfContextTimer=null,this.companionBanner=null,this.companionSourceURL=null}function i(t){var e={};if(t)try{t=T.unescape(t)}catch(a){}if(t){var n=t.indexOf(u);if(n>=0){var i=t.indexOf("&");i<0&&(i=t.indexOf(" ",n+1)),e.adswizzContext=i>0?t.substring(n+u.length,i):t.substring(n+u.length),e.adswizzContext&&(e.adswizzContext=T.unescape(e.adswizzContext))}}var o=t.indexOf(h);if(o>=0){var s=t.indexOf(" ",o+1);e.duration=s>0?parseInt(t.substring(o+h.length,s),10):parseInt(t.substring(o+h.length),10)}var r=t.indexOf(d);if(r>=0){var l=t.indexOf(" ",r+1);e.adID=l>0?t.substring(r+d.length,l):t.substring(r+d.length)}var m=t.indexOf(c);if(m>=0){var _=t.indexOf(" ",m+1);e.insertionType=_>0?t.substring(m+c.length,_):t.substring(m+c.length)}var g=t.indexOf(p);if(g>=0){var f=t.indexOf(" ",g+1);e.companionZoneID=f>0?t.substring(g+p.length,f):t.substring(g+p.length)}return void 0,e}function o(t,e,a){this.sdkInstance=t,this.metadataConnType=e,this.pollingInterval=a,this._lastMetadataTimestamp=-1,this._lastMetadataText=""}function s(t,e){var a=document.getElementsByTagName("body")[0],n=document.createElement("script");n.type="text/javascript",n.src=t,a.appendChild(n)}function r(){this._isStreamPlaying=!1,this._seekingTimeoutID=null,this._streamURL=null,this._metadataTimeoutIDs=[],this._metadataQueue=[],this._audio=null,this._howlerPlayer=null,this._metadataConnectionCallbacks={},this._metadataChangedCallbacks=null,this._USE_SETTIMEOUT_FOR_SYNCHRONIZATION=!0,this._audioTimeupdateFunction=null,this._playerId=null,this._lastProcMetTime=-1,this._lastProcMetText="",this._adBreakManager=null,this._metadataConnManager=null,this._companionAdManager=null,this._geoPosition=null,this._wpId=null,this.MetadataConnection={AUTO:m,TIMED_POLLING:_,EVENT_STREAM:g,LONG_POLLING:f},this.onReceivedDetailsInfo=null;var t=this;this.settings={setMetadataConnectionType:function(e){void 0,t._metadataConnManager&&(t._metadataConnManager.metadataConnType=e)},setUseSetTimeoutForSynchronization:function(e){t._USE_SETTIMEOUT_FOR_SYNCHRONIZATION=e,t._audio&&(e?t._audio.removeEventListener("timeupdate",t._audioTimeupdateFunction):t._audio.addEventListener("timeupdate",t._audioTimeupdateFunction))},isUsingSetTimeoutForSynchronization:function(){return t._USE_SETTIMEOUT_FOR_SYNCHRONIZATION}},this._audioTimeupdateFunction=function(){if(void 0,void 0,t._metadataQueue.length>0&&1e3*this.currentTime>=t._metadataQueue[0].start-100){var e=t._metadataQueue.shift();t._scheduleUpToDateMetadataCallback(e,0)}}}t.prototype.stop=function(){null!==this.eventSourceObj&&(this.eventSourceObj.close(),this.eventSourceObj=null)},t.prototype.initialize=function(t){return window.EventSource?""===t?(void 0,!0):null!==this.eventSourceObj?(void 0,!0):(this.metadataURL=t,t+="&details=1",void 0,this.runEventStream(t),!0):(void 0,!1)},t.prototype.runEventStream=function(t){var e=this;this.eventSourceObj=new window.EventSource(t,{withCredentials:!0}),this.eventSourceObj.addEventListener("message",function(a){var n={rawResponse:a.data,eventId:a.lastEventId},i=t.indexOf("&details=1")!==-1;e.metadataManager.receivedMetadataConnectionResponse(v,g,n,i)},!1),this.eventSourceObj.addEventListener("open",function(t){},!1),this.eventSourceObj.addEventListener("error",function(t){},!1)},e.prototype.stop=function(){null!==this.pollingTimer&&(clearTimeout(this.pollingTimer),this.pollingTimer=null),null!==this.pollingObj&&(this.pollingObj.abort(),this.pollingObj.onreadystatechange=null,this.pollingObj=null)},e.prototype.initialize=function(t,e,a){return""===t?(void 0,!1):null!==this.pollingObj?(void 0,!1):(this.metadataURL=t,this.pollingType=e,this.pollingInterval=a,this.runPolling(t+"&details=1"),!0)},e.prototype.runPolling=function(t){this.pollingObj=new XMLHttpRequest,this.pollingObj.withCredentials=!0,this.pollingObj.open("GET",t,!0);var e=this;this.pollingObj.onreadystatechange=function(){if(e.pollingObj.readyState===XMLHttpRequest.DONE){if(200===e.pollingObj.status&&e.pollingObj.responseText){var a={};a.rawResponse=e.pollingObj.responseText;var n=t.indexOf("&details=1")!==-1;e.metadataManager.receivedMetadataConnectionResponse(v,e.pollingType,a,n)}404!==e.pollingObj.status&&(e.pollingTimer=setTimeout(function(){null!==e.pollingObj&&(e.pollingObj=null,e.runPolling(e.metadataURL))},Math.max(200!==e.pollingObj.status?2e3:0,e.pollingInterval)))}},this.pollingObj.send()},a.prototype.isAdBreak=function(){return this._adBreakCount>0},a.prototype.removeExecutedAdStartTimeoutId=function(t){var e=this._timeoutsAdStart.indexOf(t);e>-1&&this._timeoutsAdStart.splice(e,1)},a.prototype.removeExecutedAdFinishTimeoutId=function(t){var e=this._timeoutsAdFinish.indexOf(t);e>-1&&this._timeoutsAdFinish.splice(e,1)},a.prototype.adswizzAdStarted=function(t,e){void 0,this._adBreakCount++,this.removeExecutedAdStartTimeoutId(e),this.sdkInstance.adswizzAdStarted(t)},a.prototype.adswizzAdFinished=function(t,e){void 0,this._adBreakCount--,this.removeExecutedAdFinishTimeoutId(e),this.isAdBreak()||this.sdkInstance.adswizzAdFinished(t)},a.prototype.processAdswizzAdData=function(t,e){var a=t&&t.adID&&t.duration>0;if(this._lastAdID=t?t.adID:null,a){if(e<-1e3&&e+t.duration<1e3)return;var n=this,i=setTimeout(function(){n.adswizzAdStarted(t,i)},Math.max(e-200,0));this._timeoutsAdStart.push(i);var o=setTimeout(function(){n.adswizzAdFinished(!1,o)},e+t.duration+1500);this._timeoutsAdFinish.push(o)}},a.prototype.onStop=function(){for(var t=0;t<this._timeoutsAdStart.length;t++)void 0,clearTimeout(this._timeoutsAdStart[t]);for(t=0;t<this._timeoutsAdFinish.length;t++)void 0,clearTimeout(this._timeoutsAdFinish[t]);this._adBreakCount=0,this._timeoutsAdStart=[],this._timeoutsAdFinish=[]},n.prototype.setCompanionBannerConfig=function(t){this.companionBanner=t},n.prototype.alwaysDisplayCompanionAds=function(){return T.isRealValue(this.companionBanner)&&T.isRealValue(this.companionBanner.alwaysDisplayAds)&&this.companionBanner.alwaysDisplayAds===!0&&T.isRealValue(this.companionBanner.fallbackZoneId)&&this.companionBanner.fallbackZoneId.length>0},n.prototype.adStarted=function(t){if(T.isRealValue(this.companionBanner)){this.stopFillerAutoRefresh();var e=this.loadAds(t);this.companionSourceURL=e,!this.alwaysDisplayCompanionAds(),this._extraExposureTimer&&(clearInterval(this._extraExposureTimer),this._extraExposureTimer=null),this._outOfContextTimer&&(clearInterval(this._outOfContextTimer),this._outOfContextTimer=null),e&&e.length>0&&this.companionBanner.willDisplayListener&&"function"==typeof this.companionBanner.willDisplayListener&&this.companionBanner.willDisplayListener(e)}},n.prototype.adFinished=function(t){function e(){a.alwaysDisplayCompanionAds()&&!t&&a.startFillerAutoRefresh(),!a.alwaysDisplayCompanionAds(),a.companionSourceURL&&a.companionSourceURL.length>0&&a.companionBanner&&a.companionBanner.outOfContextListener&&"function"==typeof a.companionBanner.outOfContextListener&&(a.companionSourceURL=null,a._outOfContextTimer=setTimeout(function(){a.companionBanner.outOfContextListener()},1e3))}var a=this;T.isRealValue(this.companionBanner)&&T.isRealValue(this.companionBanner.extraExposureTime)&&this.companionBanner.extraExposureTime>0?this._extraExposureTimer=setTimeout(e,this.companionBanner.extraExposureTime):e()},n.prototype.loadAds=function(t){var e=this.getCompanionAdURL(t.adswizzContext,t.companionZoneID);return e&&e.length>0&&this.companionBanner.container&&(this.companionBanner.container.innerHTML="<iframe src="+e+' width="100%" height="100%" scrolling="no" frameborder="no"></iframe>'),e},n.prototype.startFillerAutoRefresh=function(){this.companionBanner&&this.companionBanner.willDisplayFallbackListener&&"function"==typeof this.companionBanner.willDisplayFallbackListener&&this.companionBanner.willDisplayFallbackListener(this.getCompanionFillerURL()),this.loadCompanionBannerWithFiller();var t=this;this._refreshFillerTimer=setInterval(function(){t.loadCompanionBannerWithFiller()},t.fallbackRefreshInterval)},n.prototype.stopFillerAutoRefresh=function(){this._refreshFillerTimer&&(clearInterval(this._refreshFillerTimer),this._refreshFillerTimer=null),this._onStartTimer&&(clearInterval(this._onStartTimer),this._onStartTimer=null)},n.prototype.loadCompanionBannerWithFiller=function(){this.companionBanner&&this.companionBanner.container&&(this.companionBanner.container.innerHTML="<iframe src="+this.getCompanionFillerURL()+' width="100%" height="100%" scrolling="no" frameborder="no"></iframe>')},n.prototype.onStart=function(){if(this.alwaysDisplayCompanionAds()){var t=this;this._onStartTimer=setTimeout(function(){t.startFillerAutoRefresh()},1500)}},n.prototype.onStop=function(t){this.stopFillerAutoRefresh(),t&&(this._extraExposureTimer&&(clearInterval(this._extraExposureTimer),this._extraExposureTimer=null),this.companionBanner&&this.companionBanner.outOfContextListener&&"function"==typeof this.companionBanner.outOfContextListener&&this.companionBanner.outOfContextListener())},n.prototype.getCompanionAdURL=function(t,e){var a=this.getCompanionFillerURL();return t&&t.length>0&&(e&&e.length>0?a=T.addParameterToURL(this.companionBanner.baseURL,"zoneId",e)+"&context="+t:this.companionBanner&&this.companionBanner.zoneId&&this.companionBanner.zoneId.length>0&&(a=T.addParameterToURL(this.companionBanner.baseURL,"zoneId",this.companionBanner.zoneId)+"&context="+t)),a},n.prototype.getCompanionFillerURL=function(){return this.companionBanner.fallbackZoneId&&this.companionBanner.fallbackZoneId.length>0?T.addParameterToURL(this.companionBanner.baseURL,"zoneId",this.companionBanner.fallbackZoneId):null},o.prototype.init=function(a){var n=T.getBaseURL(a)+"/metadata?type=json&cb="+Math.floor(1e11*Math.random()),i=n+"&longPolling=true";switch(this.metadataConnType){case m:case _:this.pollingConn=new e(this),this.pollingConn.initialize(n,_,this.pollingInterval);break;case f:this.pollingConn=new e(this),this.pollingConn.initialize(i,f,100);break;case g:this.eventSource=new t(this),this.eventSource.initialize(n);break;default:void 0}this.sdkInstance._internalTriggerMetadataConnectionCallbacks("init",this.metadataConnType===f?i:n)},o.prototype.stopMetadata=function(){this.eventSource&&this.eventSource.stop(),this.pollingConn&&this.pollingConn.stop(),this._lastMetadataTimestamp=-1,this._lastMetadataText="",this.sdkInstance._internalTriggerMetadataConnectionCallbacks("stop","")},o.prototype.isNewMetadata=function(t){if(0===t.length)return!1;var e=t.length-1,a=t[e];return(a.start!==this._lastMetadataTimestamp||a.metadata!==this._lastMetadataText)&&(this._lastMetadataTimestamp=a.start,this._lastMetadataText=a.metadata,!0)},o.prototype.receivedMetadataConnectionResponse=function(t,e,a,n){var o=[],s=null;switch(t){case v:if(a&&a.rawResponse){var r=JSON.parse(a.rawResponse);if(r["metadata-list"]&&r["metadata-list"].constructor===Array)for(var l=r["metadata-list"],d=0;d<l.length;d++){var h=l[d];h.start=parseInt(h.start,10),h.awdAdData=i(h.metadata),o.push(h)}n&&(s={},s["icy-br"]=r["icy-br"],s["icy-description"]=r["icy-desription"],s["icy-genre"]=r["icy-genre"],s["icy-pub"]=r["icy-pub"],s["session-id"]=r["session-id"],s.version=r.version)}break;case y:}this.isNewMetadata(o)&&this.sdkInstance.processReceivedParsedMetadata(e,a.rawResponse,o,s)};var l="1.1.11",d="adId=",h="durationMilliseconds=",u="adswizzContext=",c="insertionType=",p="companionZoneId=",m=0,_=1,g=2,f=3,y=0,v=2,T={isRealValue:function(t){return t&&"null"!==t&&"undefined"!==t},getBaseURL:function(t){var e=t+"",a=e.split("/"),n=a[0],i=a[2];return n+"//"+i},isIEorEDGE:function(){return!!/MSIE 10/i.test(navigator.userAgent)||(!(!/MSIE 9/i.test(navigator.userAgent)&&!/rv:11.0/i.test(navigator.userAgent))||!!/Edge\/\d./i.test(navigator.userAgent))},addParameterToURL:function(t,e,a){var n=e+"="+encodeURIComponent(a),i="&";if(t.indexOf("?")<0)i="?";else{var o=t.slice(-1);"&"===o&&(i=""),"?"===o&&(i="")}return t+=i+n},unescape:window.decodeURIComponent};!function(){"undefined"==typeof com_adswizz_synchro_decorateUrl&&(s("//synchrobox.adswizz.com/register2.php"),s("//cdn.adswizz.com/adswizz/js/SynchroClient2.js"))}(),window.adswizzSDK=new r,r.prototype.getVersion=function(){return l},r.prototype.init=function(t){function e(t){l._geoPosition=t}function i(){}if(!T.isRealValue(t))return void void 0;T.isRealValue(t.playerId)?this._playerId=t.playerId:void 0;var s=_,r=2e3;T.isRealValue(t.metadata)&&(T.isRealValue(t.metadata.connectionType)&&(s=t.metadata.connectionType),T.isRealValue(t.metadata.listeners)&&(this._metadataChangedCallbacks=t.metadata.listeners),T.isRealValue(t.metadata.pollingInterval)&&(r=t.metadata.pollingInterval)),this.setContentPlayer(t.contentPlayer),this.setHowlerPlayer(t.howlerPlayer),this._metadataConnManager=new o(this,s,r),this._adBreakManager=new a(this),this._companionAdManager=new n,T.isRealValue(t.companionBanner)&&this._companionAdManager.setCompanionBannerConfig(t.companionBanner);var l=this;"geolocation"in navigator&&navigator.permissions&&navigator.permissions.query({name:"geolocation"}).then(function(t){"granted"===t.state&&(navigator.geolocation.getCurrentPosition(e,i),l._wpId=navigator.geolocation.watchPosition(e,i))})},r.prototype._isAPodcastResume=function(){var t=this._audio&&!this._audio.paused?this._audio.currentTime:0;return this._streamURL&&this._streamURL===this._audio.src&&t>0},r.prototype._onSeekingPodcast=function(){var t=window.adswizzSDK;t._isStreamPlaying&&t._onStopPlaying(),clearTimeout(t._seekingTimeoutID),t._seekingTimeoutID=setTimeout(function(){t._onStartPlaying()},2e3)},r.prototype._onStopPlaying=function(){var t=window.adswizzSDK;t._isStreamPlaying=!1;var e=!1;t._metadataConnManager&&t._metadataConnManager.stopMetadata(),t._adBreakManager&&(e=t._adBreakManager.isAdBreak(),t._adBreakManager.onStop()),t._companionAdManager&&t._companionAdManager.onStop(e);for(var a=0;a<t._metadataTimeoutIDs.length;a++)clearTimeout(t._metadataTimeoutIDs[a]);t._metadataTimeoutIDs=[],t._metadataQueue=[],t._lastProcMetTime=-1,t._lastProcMetText=""},r.prototype._onStartPlaying=function(){var t=window.adswizzSDK;t._onStopPlaying(),t._howlerPlayer&&t._howlerPlayer._src?t._streamURL=t._howlerPlayer._src:t._audio&&t._audio.src&&(t._streamURL=t._audio.src),t._isStreamPlaying=!0,t._metadataConnManager.init(t._streamURL),t._companionAdManager&&t._companionAdManager.onStart()},r.prototype.setContentPlayer=function(t){this._audio&&(this._audio.removeEventListener("playing",this._onStartPlaying),this._audio.removeEventListener("pause",this._onStopPlaying),this._audio.removeEventListener("ended",this._onStopPlaying),T.isIEorEDGE()&&this._audio.removeEventListener("seeking",this._onSeekingPodcast)),this._audio=null,T.isRealValue(t)&&(this._audio=t,this._audio.addEventListener("playing",this._onStartPlaying,!0),this._audio.addEventListener("pause",this._onStopPlaying,!0),this._audio.addEventListener("ended",this._onStopPlaying,!0),T.isIEorEDGE()&&this._audio.addEventListener("seeking",this._onSeekingPodcast,!0),this._USE_SETTIMEOUT_FOR_SYNCHRONIZATION||(void 0,this._audio.addEventListener("timeupdate",this._audioTimeupdateFunction))),this._onStopPlaying()},r.prototype.setHowlerPlayer=function(t){this._howlerPlayer&&(this._howlerPlayer.off("play",this._onStartPlaying),this._howlerPlayer.off("pause",this._onStopPlaying),this._howlerPlayer.off("end",this._onStopPlaying),this._howlerPlayer.off("seek",this._onSeekingPodcast)),this._howlerPlayer=null,T.isRealValue(t)&&(this._howlerPlayer=t,this._howlerPlayer.on("play",this._onStartPlaying),this._howlerPlayer.on("stop",this._onStopPlaying),this._howlerPlayer.on("seek",this._onSeekingPodcast)),this._onStopPlaying()},r.prototype.setCompanionBannerConfig=function(t){this._companionAdManager?this._companionAdManager.setCompanionBannerConfig(t):void 0},r.prototype.adswizzAdStarted=function(t){this._companionAdManager&&this._companionAdManager.adStarted(t)},r.prototype.adswizzAdFinished=function(t){this._companionAdManager&&this._companionAdManager.adFinished(t)},r.prototype.addMetadataChangedListener=function(t){if("function"!=typeof t)return void void 0;this._metadataChangedCallbacks=this._metadataChangedCallbacks||[];for(var e=0;e<this._metadataChangedCallbacks.length;e++)if(this._metadataChangedCallbacks[e]===t)return void void 0;"function"==typeof t&&this._metadataChangedCallbacks.push(t)},r.prototype.removeMetadataChangedListener=function(t){this._metadataChangedCallbacks=this._metadataChangedCallbacks||[];var e=this._metadataChangedCallbacks.indexOf(t);e>-1?this._metadataChangedCallbacks.splice(e,1):void 0},r.prototype.addMetadataConnectionListener=function(t,e){this._metadataConnectionCallbacks[t]=this._metadataConnectionCallbacks[t]||[],"function"==typeof e&&this._metadataConnectionCallbacks[t].push(e)},r.prototype._internalTriggerMetadataConnectionCallbacks=function(t,e){var a=this._metadataConnectionCallbacks[t];if(T.isRealValue(a)){if(a.constructor!==Array)return void void 0;for(var n=0;n<a.length;n++){var i=a[n];setTimeout(i,0,e)}}},r.prototype._removeExecutedTimeoutId=function(t){var e=this._metadataTimeoutIDs.indexOf(t);e>-1&&this._metadataTimeoutIDs.splice(e,1)},r.prototype._scheduleUpToDateMetadataCallback=function(t,e){function a(){var e=0;n._howlerPlayer?e=n._howlerPlayer.seek():n._audio&&(e=n._audio.paused?0:n._audio.currentTime);var a=Math.floor(1e3*e)-t.start;if(void 0,n._metadataChangedCallbacks.constructor===Array)for(var i=0;i<n._metadataChangedCallbacks.length;i++){var o=n._metadataChangedCallbacks[i];"function"==typeof o&&o(t.metadata)}}if(this._metadataChangedCallbacks){var n=this;if(0===e)return void a();var i=setTimeout(function(){n._removeExecutedTimeoutId(i),a()},e);this._metadataTimeoutIDs.push(i)}},r.prototype.getLastProcMetIndex=function(t){for(var e=0;e<t.length;e++){var a=t[e];if(a.start===this._lastProcMetTime&&a.metadata===this._lastProcMetText)return e}return-1},r.prototype.processReceivedParsedMetadata=function(t,e,a,n){var i=0;this._howlerPlayer?i=this._howlerPlayer.seek():this._audio&&(i=this._audio.paused?0:this._audio.currentTime);for(var o=this.getLastProcMetIndex(a),s=o+1;s<a.length;s++){var r=a[s],l=Math.floor(r.start-1e3*i);l<0&&l>=-1e3&&(l=0),this._USE_SETTIMEOUT_FOR_SYNCHRONIZATION?(this._adBreakManager.processAdswizzAdData(r.awdAdData,l),l>=0?(void 0,this._scheduleUpToDateMetadataCallback(r,l)):void 0):(this._adBreakManager.processAdswizzAdData(r.awdAdData,l),l>=0?(void 0,this._metadataQueue.push(r)):void 0),s===a.length-1&&(this._lastProcMetTime=r.start,this._lastProcMetText=r.metadata)}n&&this.onReceivedDetailsInfo&&"function"==typeof this.onReceivedDetailsInfo&&this.onReceivedDetailsInfo(n);var d=(t===g?"EVENT_SOURCE":t===f?"LONG_POLLING":"TIMED_POLLING")+"\n\tResponse: "+e+"\n\tAudio Pos: "+i+"\n\n";this._internalTriggerMetadataConnectionCallbacks("message",d)},r.prototype.decorateURL=function(t){com_adswizz_synchro_decorateUrl&&"function"==typeof com_adswizz_synchro_decorateUrl&&t.indexOf("listenerid=")===-1&&(t=com_adswizz_synchro_decorateUrl(t));var e=t.replace("http://","");e=e.replace("https://","");var a="";return a=e.indexOf("/")===-1?"/?":e.lastIndexOf("/")===e.length-1?"?":e.indexOf("?")!==-1?"&":"?",t+=a+"aw_0_1st.version="+encodeURIComponent(l+":html5"),void 0!==this._geoPosition&&null!==this._geoPosition&&void 0!==this._geoPosition.coords&&(t+="&aw_0_1st.gpslat="+this._geoPosition.coords.latitude+"&aw_0_1st.gpslong="+this._geoPosition.coords.longitude),null!==this._playerId&&void 0!==this._playerId&&(t+="&aw_0_1st.playerid="+this._playerId+"&aw_0_1st.skey="+Math.round((new Date).getTime()/1e3)),t}}();